---
title: "Evolución temporal y comparativa de ransomware"
author: "Team_02"
date: "11 de diciembre de 2018"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## 1. Introducción
El objeto de esta práctica es, a partir de los datos entregados en la página web "https://ransomwaretracker.abuse.ch, detectar una tendencia (si la hubiera) de los ransomware más ocurrentes en los últimos tres años.
Para ello, se decargan los datos facilitados por esta página y se realiza un estudio de los mismos.

### 1.1 Datos
Los datos que facilita la página web contienen información de las siguientes familias de ransomware:

* TeslaCrypt
* CryptoWall
* TorrentLocker
* PadCrypt 
* Locky 
* CTB-Locker 
* FAKBEN 
* PayCrypt
* DMALocker 
* Cerber
* Sage
* GlobeImposter

Para cada uno de estas familias, conseguimos datos sobre, por ejemplo:

* Fecha en la que se añadió
* Amenaza
* Host
* ...


Los datos se nos presentan en formato **.csv**.


## 2. Descarga y análisis primario de datos

Descargamos el fichero https://ransomwaretracker.abuse.ch/feeds/csv/.

```{r file_load, error=FALSE, warning=FALSE, message=FALSE}
source("./R/code.R")
df <- downloadCSV()
```

Mostramos un resumen de los datos sin depurar.

```{r df str}
str(df)

```


```{r df summary}
summary(df)

```

Eliminamos las columnas que no nos interesan para este estudio, quedando la estructura de la siguiente forma:

```{r df delete columns, echo=FALSE}
df <- DeleteColumns(df)

```

```{r summary 2}
summary (df)
```

Para realizar un primer análisis gráfico necesitamos depurar y arreglar los datos para facilitar su utilización: cambiamos el nombre de la columna que muestra la fecha, separamos las horas y las fechas en dos columnas.

```{r change data}
df <- changeColumnName(df,"X..Firstseen..UTC.","DateHour")
df <- separateDate(df)

```

```{r head}
head (df)

```



Estudiamos la fecha y nos damos cuenta de que disponemos de datos para los años 2015, 2016, 2017 y 2018.

Presentamos una primera aproximación gráfica de ocurrencia de Malware en los años 2015-2018, a partir de los datos de los que disponemos.

```{r barplot año2015, warning=FALSE, message=FALSE, fig.align="center",out.width='100%', out.height='100%'}
Bar_plot_year(df,"2015")

```
\
\
```{r barplot año2016, warning=FALSE, message=FALSE, fig.align="center",out.width='100%', out.height='100%'}
Bar_plot_year(df,"2016")

```
\
\
Escalamos el eje y, y visualizamos aquellos Malware con valores inferiores al límite superior:
\
```{r barplot año2016 escalado, warning=FALSE, message=FALSE, fig.align="center",out.width='100%', out.height='100%'}
Bar_plot_year_scale(df,"2016",200)

```
\
\
```{r barplot año2017, warning=FALSE, message=FALSE, fig.align="center",out.width='100%', out.height='100%'}
Bar_plot_year(df,"2017")

```
\
\
Escalamos el eje y, y visualizamos aquellos Malware con valores inferiores al límite superior:
\
```{r barplot año2017 escalado, warning=FALSE, message=FALSE, fig.align="center",out.width='100%', out.height='100%'}
Bar_plot_year_scale(df,"2017",200)

```
\
\

```{r barplot año2018, warning=FALSE, message=FALSE, fig.align="center",out.width='100%', out.height='100%'}
Bar_plot_year(df,"2018")

```

\
\

En un primer vistazo, detectamos que los Malware más ocurrentes en los últimos años son: Cerber, GlobeImposter, TorrentLocker, Locky, TeslaCrypt y CryptoWall.
Agrupamos los datos por familia de Malware y ordenamos por orden de ocurrencia.

```{r suma}
dfsum <- SumColumnsMalwareTotal(df)

```
```{r suma total, echo=FALSE, results='asis'}
library(knitr)
kable(dfsum, caption="Sumatorio Malware")
```

Como podemos observar, del conjunto anterior, los Malware más comunes son los tres primeros Malware de la tabla, y con mucha diferencia, en los años de los que se disponen datos (2015-2018). Es por eso que centraremos el análisis en estas tres familias de malware:

* Locky 
* Cerber
* TeslaCrypt

Sumamos el resto de ocurrencias de las otras familias y creamos una nueva entrada "Other" con el cálculo realizado.


```{r suma parcial}
dfMax <- SumColumnsMalware(dfsum)

```
```{r suma parcial 2, echo=FALSE, results='asis'}
library(knitr)
kable(dfMax, caption="Sumatorio Malware (máximos)")
```

### 2.1 Porcentaje ocurrencias Malware (Pie Chart)

Mostramos el porcentaje de ocurrencia de las familias malware mostradas en la tabla anterior de forma gráfica:

```{r pie chart, warning=FALSE, message=FALSE, fig.align="center", out.width='100%', out.height='100%'}
Plot_pie_Max(dfMax)

```
\newline

### 2.1 Ocurrencias Malware por semestre (Bar Plot)

Como ya hemos verificado en la gráfica anterior, los Malware *Locky*, *Cerber* y *TeslaCrypt* tienen el mayor porcentaje de ocurrencia entre los años 2015-2018. El porcentaje de la suma del resto de familias es igual que el menor del trío de Malware escogido.

Así pues, confirmamos la elección de la tríada de Malware.

Vamos a analizar ahora la ocurrencia de Malware en los diferentes semestres de los años 2015-2018.

Modificamos nuestra tabla de datos para facilitar la realización de la gráfica. 

```{r semestre, warning=FALSE}
dfSem <- SemesterColumnsMalwareTotal(df)

```
```{r semestre 2, echo=FALSE, results='asis'}
library(knitr)
kable(dfSem, caption="Sumatorio Malware (semestres)")
```

En formato gráfico:

```{r barplot semesterLocky, warning=FALSE, message=FALSE, fig.align="center",out.width='100%', out.height='100%'}
Bar_plot_semester_Locky(dfSem)

```


```{r barplot semesterCerber, warning=FALSE, message=FALSE, fig.align="center",out.width='100%', out.height='100%'}
Bar_plot_semester_Cerber(dfSem)

```


```{r barplot semesterTesla, warning=FALSE, message=FALSE, fig.align="center",out.width='100%', out.height='100%'}
Bar_plot_semester_Tesla(dfSem)

```
## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE, out.width='150%', out.height='150%'}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
